<script src="https://sdk.amazonaws.com/js/aws-sdk-2.3.19.js"></script>
<script src="utility.js"></script>
<script src="secrets.js"></script>
<script src="cloudy-gamer.js"></script>

instance status: <span id='instance-status'>(retrieving)</span><br/>
volume status: <span id='volume-status'>(retrieving)</span><br/>
<button onclick="javascript:updateStatuses()">update status</button><br/>
<br/>
<button onclick="javascript:startInstance()">start instance</button>
<button onclick="javascript:stopInstance()">stop instance</button><br/>
<button onclick="javascript:cg.restartSteam()">restart steam</button><br/>
<br/>
<span id='cur-status'></span><br/>
<br/>

<div id='config-container'>
sup brah
</div>

<script>
  self.cg = new CloudyGamer(document.ACCESS_KEY, document.SECRET_ACCESS_KEY)

  self.startInstance = () => {
    self.cg.startInstance().then(_ => {
      self.updateStatuses()
    })
  }

  self.stopInstance = () => {
    self.cg.stopInstance().then(_ => {
      self.updateStatuses()
    })
  }

  self.updateStatuses = () => {
    const instanceStatusEl = document.querySelector("#instance-status")
    const volumeStatusEl = document.querySelector("#volume-status")

    instanceStatusEl.textContent = "(retrieving)"
    volumeStatusEl.textContent = "(retrieving)"
    self.cg.getInstance().then(result => {
      self.cg.isInstanceOnline(result.InstanceId).then(isOnline => {
        const rdpUrl = `rdp://full%20address=s:${result.PublicIpAddress}:3389&username=s:cloudygamer&desktopwidth=i:1024&desktopheight=i:768`

        instanceStatusEl.innerHTML = `running (${result.InstanceId}, <a href='${rdpUrl}'>${result.PublicIpAddress}</a>, ${isOnline ? "online" : "offline"})`
      })
    }).catch(_ => {
      instanceStatusEl.textContent = "not running"
    })

    self.cg.isVolumeAvailable().then(result => {
      volumeStatusEl.textContent = result ? "available" : "in use"
    })
  }

  self.updateStatuses()
</script>